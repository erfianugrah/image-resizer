name = "image-resizer"
main = "src/index.js"
compatibility_date = "2021-09-21"
account_id = "25f21f141824546aa72c74451a11b419"

[observability]
enabled = true
head_sampling_rate = 1 # optional. default = 1.

[env]
FALLBACK_BUCKET = "https://cdn.erfianugrah.com"

[dev]
port = 9001
local_protocol = "http"
upstream_protocol = "https"

# Direct mode deployment (worker runs on the bucket)
[env.direct]
name = "direct-resizer"

[env.direct.vars]
ENVIRONMENT = "direct"
DEPLOYMENT_MODE = "direct"

# Remote mode deployment (worker fetches from remote buckets)
[env.remote]
name = "remote-resizer"

[env.remote.vars]
ENVIRONMENT = "remote"
DEPLOYMENT_MODE = "remote"
REMOTE_BUCKETS = "{\"default\":\"https://cdn.erfianugrah.com\"}"

# Staging environment
[env.staging]
name = "staging-resizer"

[env.staging.vars]
ENVIRONMENT = "staging"
DEPLOYMENT_MODE = "direct"

# Production environment
[env.prod]
name = "prod-resizer"

[env.prod.vars]
ENVIRONMENT = "production"
DEPLOYMENT_MODE = "remote"
REMOTE_BUCKETS = "{\"default\":\"https://cdn.erfianugrah.com\"}"

[[env.prod.routes]]
pattern = "images.erfi.dev/*"
zone_id = "d6260a9cd0c27db1e9c0a453b2e4761e"
